## Лабораторная работа. Настройка и проверка расширенных списков контроля доступа.
### Топология
![](Top3.png)
![](Tabadr1.png)
![](Tabvlan1.png)
## Задачи
### Часть 1. Создание сети и настройка основных параметров устройства
### Часть 2. Настройка и проверка списков расширенного контроля доступа
## Часть 1. Создание сети и настройка основных параметров устройства
### Шаг 1. Создайте сеть согласно топологии.
### Шаг 2. Произведите базовую настройку маршрутизаторов.
### Шаг 3. Настройте базовые параметры каждого коммутатора.
## Часть 2. Настройка сетей VLAN на коммутаторах.
### Шаг 1. Создайте сети VLAN на коммутаторах.
### Шаг 2. Назначьте сети VLAN соответствующим интерфейсам коммутатора.
#### Выполнение команды на S1: show vlan brief
![](S1shvlanbr.png)
#### Выполнение команды на S2: show vlan brief
![](S2shvlanbr.png)
## Часть 3. ·Настройте транки (магистральные каналы).
### Шаг 1. Вручную настройте магистральный интерфейс F0/1.
#### Выполнение команды на S1: show int trunk
![](shinttrS1.png)
#### Выполнение команды на S2: show int trunk
![](shinttrS21.png)
### Шаг 2. Вручную настройте магистральный интерфейс F0/5 на коммутаторе S1.
#### Выполнение команды на S1: show int trunk
![](shinttrS12.png)
## Часть 4. Настройте маршрутизацию.
### Шаг 1. Настройка маршрутизации между сетями VLAN на R1.
#### Выполнение команды на R1: show ip int br
![](shipintbrR1.png) 
### Шаг 2. Настройка интерфейса R2 g0/0/1 с использованием адреса из таблицы и маршрута по умолчанию с адресом следующего перехода 10.20.0.1
#### Выполнение команды на R2: show ip int br
![](shipintbrR2.png) 
#### Выполнение команды на R2: show ip route
![](shiprouteR2.png) 
## Часть 5. Настройте удаленный доступ
### Шаг 1. Настройте все сетевые устройства для базовой поддержки SSH.
###### a.	Создайте локального пользователя с именем пользователя SSHadmin и зашифрованным паролем $cisco123!
###### b.	Используйте ccna-lab.com в качестве доменного имени.
###### c.	Генерируйте криптоключи с помощью 1024 битного модуля.
###### d.	Настройте первые пять линий VTY на каждом устройстве, чтобы поддерживать только SSH-соединения и с локальной аутентификацией.
#### [Выполнение команды на примере S2:](SSH)
### Шаг 2. Настройка маршрутизатора R1 для подключения сервера SRV1:
#### Настройка IP-адреса интерфейса Gi0/0/0: 172.16.1.1 /24
#### Настройка IP-адреса интерфейса Fa0 сервера SRV1: 172.16.1.2 /24
## Часть 6. Проверка подключения
### Шаг 1. Настройте узлы ПК.
#### Адреса ПК можно посмотреть в таблице адресации.
##### Выполнена настройка адресации согласно таблице и схемы топологии.
#### [Конфигурация R1 после всех настроек](confR1)
#### [Конфигурация R2 после всех настроек](confR2)
#### [Конфигурация S1 после всех настроек](confS1)
#### [Конфигурация S2 после всех настроек](confS2)
### Шаг 2. Выполните следующие тесты. Эхозапрос должен пройти успешно.
### Таблица проверок:
![](Tabprov1.png) 
#### Т.к. HTTP/HTTPS развернуты на выделенном сервере SRV1 (IP: 172.16.1.2), то проверки HTTPS из таблицы необходимо выполнить на адрес 172.16.1.2.
#### Все проверки проходят успешно!
## Часть 7. Настройка и проверка списков контроля доступа (ACL)
##### При проверке базового подключения компания требует реализации следующих политик безопасности:
#### Политика1. Сеть Sales не может использовать SSH в сети Management (но в  другие сети SSH разрешен). 
#### Политика 2. Сеть Sales не имеет доступа к IP-адресам в сети Management с помощью любого веб-протокола (HTTP/HTTPS). Сеть Sales также не имеет доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1).
#### Политика3. Сеть Sales не может отправлять эхо-запросы ICMP в сети Operations или Management. Разрешены эхо-запросы ICMP к другим адресатам. 
#### Политика 4: Cеть Operations  не может отправлять ICMP эхозапросы в сеть Sales. Разрешены эхо-запросы ICMP к другим адресатам. 
##### Для проверки политики №2 - запрет доступа подсети Sales к IP-адресам в сети Management  с помощью любого веб-проотокола (HTTP/HTTPS) и т.к. в CPT нет возможности реализовать веб-сервер на роутере R1, в топологию включен дополнительный сервер WEB INT (IP:10.20.0.10/24) порт Fa0/2 на коммутаторе в режиме access VLAN 20.
![](Top4.png) 
#### Политика 1: Сеть Sales не может использовать SSH в сети Management (но в другие сети SSH разрешен).
##### Создаем расширенный именованный ACL: DENY_SALES
###### R1(config)#ip access-list extended DENY_SALES
##### Создаем правило, запрещающее доступ из сети 10.40.0.0/24 в сеть 10.20.0.0/24 по TCP порту 22 (SSH):
###### R1(config-ext-nacl)#deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 22
##### Создаем разрешающее правило на все взаимодействие по протоколу IP:
###### R1(config-ext-nacl)#permit any any
##### Применяем созданный ACL на входящий трафик инт. G0/0/1.40 роутера R1:
###### R1(config-ext-nacl)#int g0/0/1.40
###### R1(config-subif)#ip access-group DENY_SALES in
##### Выполнение проверок:
##### С PC-B (IP:10.40.0.10/24 – VLAN SALES) проходит ping до всех интерфейсов
##### подключения к хостам по SSH с IP-адресами из подсети Management, а это инт. G0/0/1.20 роутера R1 и инт. G0/0/1 роутера R2 не происходит; подключение по SSH к R1 через IP-адреса 172.16.1.1, 10.30.0.1, 10.40.0.1 осуществляется. 
#### Политика 2. Сеть Sales не имеет доступа к IP-адресам в сети Management с помощью любого веб-протокола (HTTP/HTTPS). Сеть Sales также не имеет доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1).
##### Запрет сети Sales доступ в Management с помощью любого web-протокола реализуется добавлением в ранее созданный ACL DENY_SALES правил:
###### R1(config-ext-nacl)#deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 80
###### R1(config-ext-nacl)#deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 443
##### Правила возможно добавлять с помощью редактирования строк в режиме конфигурации ACL (добавить строки 11 и 12), при написании политики №2 существующий ACL политики №1 был удален полностью и создан новый с 4-я правилами.
##### Вывод информации об ACL:
###### R1(config-ext-nacl)#do sh access-list
###### Extended IP access list DENY_SALES
######     10 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 22
  ######  20 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq www
   ###### 30 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 443
   ###### 40 permit ip any any
##### Запрет сети Sales доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1).
##### В CPT отсутствует возможность развернуть WEB-сервер на роутере R1. Доступ к специально созданному для проверок WEB-серверу в сети Management (WEB INT) уже запрещен ранее при реализации первой части политики №2, при этом сохраняется доступ по HTTP и HTTPS к WEB-серверу SRV1 IP: 172.16.1.2 /24.
##### Выполнение проверок:
##### На PC-B  через браузер невозможно получить доступ по HTTP и HTTPS  к IP-адресу сервера WEB INT (10.20.0.10).  При этом доступ по HTTP и HTTPS к IP-адресу сервера SRV1 (172.16.1.2) осуществляется.
#### Политика3. Сеть Sales не может отправлять эхо-запросы ICMP в сети Operations или Management. Разрешены эхо-запросы ICMP к другим адресатам.
##### В режиме конфигурации ACL добавляем два правила:
###### R1(config)#ip access-list extended DENY_SALES
###### R1(config-ext-nacl)#32 deny icmp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 echo
###### R1(config-ext-nacl)#34 deny icmp 10.40.0.0 0.0.0.255 10.30.0.0 0.0.0.255 echo
##### Выполнение проверок:
##### При выполнении команды ping на PC-B отвечают на запросы только инт. с IP-адресами 10.40.0.1, 172.16.1.2, 172.16.1.1.
##### При этом, т.к. запрещены только эхо-запросы, то если с PC-A (VLAN Operations) пропинговать 10.40.0.10, то команда будет выполнена успешно потому что ответы от 10.40.0.10 придут. 
#### Политика 4: Cеть Operations  не может отправлять ICMP эхозапросы в сеть Sales. Разрешены эхо-запросы ICMP к другим адресатам
##### Создаем расширенный именованный ACL: DENY_ OPERATIONS
###### R1(config)#ip access-list extended DENY_OPERATIONS
##### Создаем правила:
###### R1(config-ext-nacl)#deny icmp 10.30.0.0 0.0.0.255 10.40.0.0 0.0.0.255 echo
###### R1(config-ext-nacl)#permit ip any any
##### Применяем созданный ACL на входящий трафик инт. G0/0/1.30 роутера R1:
###### R1(config-ext-nacl)#int g0/0/1.30
###### R1(config-subif)#ip access-group DENY_ OPERATIONS in
##### Выполнение проверок:
##### После выполненных настроек пропадает пинг с PC-A на адрес 10.40.0.10, который успешно выполнялся при проверке политики №3. Успешно выполняется команда ping на адреса из подсети 10.20.0.0/24 и на адреса 172.16.1.1/24.
##### Итоговые ACL на R1:
###### R1#sh access-lists 
###### Extended IP access list DENY_SALES
###### 10 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 22 (33 match(es))
###### 20 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq www (12 match(es))
###### 30 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 443
###### 32 deny icmp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 echo (4 match(es))
###### 34 deny icmp 10.40.0.0 0.0.0.255 10.30.0.0 0.0.0.255 echo (4 match(es))
###### 40 permit ip any any (103 match(es))
###### Extended IP access list DENY_OPERATIONS
###### 10 deny icmp 10.30.0.0 0.0.0.255 10.40.0.0 0.0.0.255 echo (4 match(es))
###### 20 permit ip any any (8 match(es))
### Политика 5. Реализация и проверка.
##### Для выполнения задания в части 2 политики №2: "Сеть Sales также не имеет доступа к интерфейсам R1 с помощью любого веб-протокола. Разрешён весь другой веб-трафик (обратите внимание — Сеть Sales  может получить доступ к интерфейсу Loopback 1 на R1)", т.к. в CPT отсутствует возможность развернуть HTTP/HTTPS сервер на маршрутизаторе R1 предлагаю другую формулировку: "Сеть Operations не имеет доступа к интерфейсам R1 с помощью протокола SSH. Разрешён весь другой SSH-трафик (обратите внимание — Сеть Operations  может получить доступ к интерфейсу Loopback 1 на R1)".
##### Т.е. необходимо закрыть доступ по TCP порту 22, а не по портам 80 и 443 как в задании с web-трафиком. SSH-сервер на R1 развернут ранее.
##### Выполняем настройку loopback интерфейса на R1 (IP-адрес для Lo 1: 10.10.10.1/24):
###### R1(config)#int lo 1
###### R1(config-if)#ip add 10.10.10.1 255.255.255.0
###### ip add 10.10.10.1 255.255.255.0
##### Далее на R1 редактируем ACL DENY_OPERATIONS:
###### R1(config)#ip access-list extended DENY_OPERATIONS
###### R1(config-ext-nacl)# no 20
###### R1(config-ext-nacl)#20 deny tcp 10.30.0.0 0.0.0.255 host 10.20.0.1 eq 22
###### R1(config-ext-nacl)#30 deny tcp 10.30.0.0 0.0.0.255 host 10.30.0.1 eq 22
###### R1(config-ext-nacl)#40 deny tcp 10.30.0.0 0.0.0.255 host 10.40.0.1 eq 22
###### R1(config-ext-nacl)#50 deny tcp 10.30.0.0 0.0.0.255 host 172.16.1.1 eq 22
###### R1(config-ext-nacl)#permit ip any any
##### Вывод информации об ACL на R1:
###### R1(config-ext-nacl)#do sh access-list
###### Extended IP access list DENY_SALES
######     10 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 22
######     20 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq www
######     30 deny tcp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 eq 443
######     40 deny icmp 10.40.0.0 0.0.0.255 10.20.0.0 0.0.0.255 echo
######     50 deny icmp 10.40.0.0 0.0.0.255 10.30.0.0 0.0.0.255 echo
######     60 permit ip any any
###### Extended IP access list DENY_OPERATIONS
######     10 deny icmp 10.30.0.0 0.0.0.255 10.40.0.0 0.0.0.255 echo
######     20 deny tcp 10.30.0.0 0.0.0.255 host 10.20.0.1 eq 22
######     30 deny tcp 10.30.0.0 0.0.0.255 host 10.30.0.1 eq 22
######     40 deny tcp 10.30.0.0 0.0.0.255 host 10.40.0.1 eq 22
######     50 deny tcp 10.30.0.0 0.0.0.255 host 172.16.1.1 eq 22
######     60 permit ip any any
#### Выполнение проверки.
##### С PC-A (который в сети Operations IP: 10.30.0.10/24) невозможно подключиться по SSH к R1 по IP-адресам всех интерфейсов (10.20.0.1, 10.30.0.1, 10.40.0.1, 172.16.1.1). Подключение возможно только по IP-адреса инт. loopback 1: 10.10.10.1.

#### [Итоговая конфигурация R1](endconfR1)
